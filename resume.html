<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>resume - george larson</title>
  <link rel="stylesheet" href="/style.css" />
  <meta name="description" content="Plain text resume for George Larson, director of technology and builder focused on pragmatic systems and privacy-aware AI." />
</head>
<body>
  <main class="page">
    <h1>resume.txt<span class="caret" aria-hidden="true"></span></h1>
    <p class="lead">rendered directly from the source text for printing, diffing, and quick scans.</p>

    <section class="lens" aria-label="resume lenses">
      <h2>view the resume through a specific lens</h2>
      <p class="hint">Live summaries run on Cloudflare using the Hugging Face Inference API (token stays server-side). Saved lenses remain available for quick scanning.</p>

      <div class="lens-live">
        <h3>Generate a fresh take</h3>
        <form id="lens-form" class="lens-form">
          <label class="lens-field">
            <span>Focus</span>
            <input id="lens-input" type="text" name="lens" maxlength="240" placeholder="e.g., AI privacy, manufacturing uptime, leadership style" required />
          </label>
          <label class="lens-field">
            <span>Model</span>
            <select id="lens-model" name="model">
              <option value="mistralai/Mistral-7B-Instruct-v0.3">Mistral 7B Instruct (default)</option>
              <option value="meta-llama/Llama-3-8b-chat-hf">Llama 3 8B Chat</option>
              <option value="google/gemma-2-9b-it">Gemma 2 9B Instruct</option>
            </select>
          </label>
          <button type="submit" id="lens-submit">Generate summary</button>
        </form>
        <p class="hint">Need ideas? These prompts showcase how the tool reacts.</p>
        <div class="lens-suggestions" id="lens-suggestions" aria-label="Quick lens suggestions"></div>
        <div id="lens-status" class="hint" role="status" aria-live="polite">Describe a focus and press enter to generate a custom summary.</div>
        <article id="live-detail" class="lens-panel" aria-live="polite">
          <p class="hint">No live summary yet. Submit the form to see the resume reframed for your focus.</p>
        </article>
      </div>

      <div class="lens-saved">
        <h3>Saved lenses</h3>
        <div id="lens-menu" class="lens-buttons" role="tablist" aria-label="Available resume lenses"></div>
        <article id="lens-detail" class="lens-panel" role="tabpanel" tabindex="0" aria-live="polite">
          <p class="hint">Select a saved lens to see an AI-assisted summary and suggested reading inside the resume.</p>
        </article>
      </div>
    </section>

    <pre id="resume-text">loading resume...</pre>
    <footer>
      <hr />
      <span>return to <a href="/index.html">home</a> / <a href="/schedule.html">schedule time</a></span>
    </footer>
  </main>
  <script>
    const QUICK_LENSES = [
      { title: "AI + privacy", prompt: "How does George apply AI while guarding privacy and regulated data?" },
      { title: "Manufacturing ops", prompt: "Explain George's manufacturing, PLC, and uptime experience." },
      { title: "Technology leadership", prompt: "Summarise how George leads teams and ships roadmaps." },
      { title: "Meditation influence", prompt: "Connect George's Zen practice to his leadership style." },
      { title: "Baker?", prompt: "Evaluate George's resume as if he were interviewing for a baker role." }
    ];

    const state = {
      resumeText: "",
      lenses: [],
      selectedLens: null,
      liveResult: null,
      loading: false
    };

    async function loadResume(){
      const target = document.getElementById("resume-text");
      try{
        const res = await fetch("/resume.txt", {cache:"no-store"});
        if(!res.ok) throw new Error("fetch failed");
        state.resumeText = (await res.text()).trim();
        target.textContent = state.resumeText;
      }catch(err){
        target.textContent = "Resume could not be loaded. Please download it directly at /resume.txt.";
      }
    }

    function renderSavedLens(lens){
      const detail = document.getElementById("lens-detail");
      if(!lens){
        detail.innerHTML = '<p class="hint">Select a saved lens to see an AI-assisted summary and suggested reading inside the resume.</p>';
        detail.setAttribute("aria-label", "lens summary");
        return;
      }
      const points = lens.key_points || [];
      const terms = lens.recommended_terms || [];
      const notes = lens.source_notes || [];
      detail.setAttribute("aria-label", lens.title + " summary");
      detail.innerHTML = `
        <h3>${lens.title}</h3>
        <p>${lens.summary}</p>
        ${points.length ? `<ul class="plain-list">${points.map(item => `<li>${item}</li>`).join("")}</ul>` : ""}
        ${terms.length ? `<p class="hint">jump-start a deeper dive:</p>
          <div class="tag-list">${terms.map(term => `<a class="tag" href="/ask.html?q=${encodeURIComponent(term)}" title="Search the resume for ${term}">${term}</a>`).join("")}</div>` : ""}
        ${notes.length ? `<p class="hint">source sections: ${notes.join(", ")}</p>` : ""}
      `;
    }

    function renderLive(result){
      const panel = document.getElementById("live-detail");
      if(!result){
        panel.innerHTML = '<p class="hint">No live summary yet. Submit the form to see the resume reframed for your focus.</p>';
        return;
      }
      const bullets = result.key_points || [];
      panel.innerHTML = `
        <h3>Live lens: ${result.lens}</h3>
        <p>${result.summary}</p>
        ${bullets.length ? `<ul class="plain-list">${bullets.map(item => `<li>${item}</li>`).join("")}</ul>` : ""}
        <p class="hint">Generated with ${result.model} at ${new Date(result.generated_at || Date.now()).toLocaleTimeString()}.</p>
      `;
    }

    function mountLensMenu(){
      const menu = document.getElementById("lens-menu");
      menu.innerHTML = "";
      if(!state.lenses.length){
        menu.innerHTML = '<p class="hint">Saved lenses are unavailable right now.</p>';
        return;
      }
      state.lenses.forEach((lens, index) => {
        const button = document.createElement("button");
        button.className = "lens-button";
        button.type = "button";
        button.textContent = lens.title;
        button.setAttribute("role", "tab");
        const isSelected = state.selectedLens === lens.id;
        button.setAttribute("aria-selected", isSelected ? "true" : "false");
        button.setAttribute("tabindex", isSelected ? "0" : "-1");
        button.addEventListener("click", () => {
          state.selectedLens = lens.id;
          renderSavedLens(lens);
          [...menu.children].forEach(child => {
            child.setAttribute("aria-selected", child === button ? "true" : "false");
            child.setAttribute("tabindex", child === button ? "0" : "-1");
          });
          button.focus();
        });
        menu.appendChild(button);
        if(index === 0 && !state.selectedLens){
          state.selectedLens = lens.id;
          renderSavedLens(lens);
          button.setAttribute("aria-selected", "true");
          button.setAttribute("tabindex", "0");
        }else if(!isSelected){
          button.setAttribute("aria-selected", "false");
          button.setAttribute("tabindex", "-1");
        }
      });
    }

    async function loadLenses(){
      try{
        const res = await fetch("/data/resume_lenses.json", {cache:"no-store"});
        if(!res.ok) throw new Error("fetch failed");
        const data = await res.json();
        state.lenses = data.lenses || [];
        state.selectedLens = null;
      }catch(err){
        state.lenses = [];
        const detail = document.getElementById("lens-detail");
        detail.innerHTML = '<p class="hint">Saved lenses could not be loaded. You can regenerate them with scripts/generate_lenses.py.</p>';
      }
      mountLensMenu();
    }

    function mountSuggestions(){
      const container = document.getElementById("lens-suggestions");
      container.innerHTML = "";
      QUICK_LENSES.forEach(item => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "lens-suggestion";
        btn.textContent = item.title;
        btn.addEventListener("click", () => {
          const input = document.getElementById("lens-input");
          input.value = item.prompt;
          input.focus();
        });
        container.appendChild(btn);
      });
    }

    function setLoading(isLoading, message){
      state.loading = Boolean(isLoading);
      const status = document.getElementById("lens-status");
      status.textContent = message || "";
      const submit = document.getElementById("lens-submit");
      submit.disabled = state.loading;
      submit.textContent = state.loading ? "Generating..." : "Generate summary";
    }

    function showStatus(message){
      const status = document.getElementById("lens-status");
      status.textContent = message || "";
    }

    async function handleGeneration(event){
      event.preventDefault();
      if(state.loading) return;
      const input = document.getElementById("lens-input");
      const modelSelect = document.getElementById("lens-model");
      const lensText = input.value.trim();
      if(!lensText){
        showStatus("Please describe the lens you want to explore.");
        return;
      }
      setLoading(true, "Generating summaryâ€¦");
      try{
        const response = await fetch("/api/lens-summary", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ lens: lensText, model: modelSelect.value })
        });
        const data = await response.json();
        if(!response.ok){
          throw new Error(data.error || "Generation failed.");
        }
        state.liveResult = data;
        renderLive(data);
        setLoading(false, "Summary generated.");
      }catch(err){
        console.error(err);
        setLoading(false, "");
        showStatus(err.message || "Generation failed. Please try again.");
      }
    }

    window.addEventListener("DOMContentLoaded", async () => {
      mountSuggestions();
      renderLive(null);
      document.getElementById("lens-form").addEventListener("submit", handleGeneration);
      await loadResume();
      await loadLenses();
    });
  </script>
</body>
</html>
